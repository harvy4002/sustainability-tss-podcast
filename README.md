# Sustainability TSS Podcast

This project has been refactored from an Instapaper RSS-based tool into a standalone web-to-audio podcast generator. It allows users to submit any web article URL via a landing page, which is then parsed, converted to speech using Google Cloud TTS, and added to a podcast feed.

## üöÄ Technical Overview for Handover

### 1. Architecture
- **Backend:** Google Cloud Functions (Gen 2) using Node.js 20.
- **Storage:** Google Cloud Storage (GCS) bucket `sustainability-podcast-data` stores the MP3 files, the RSS feed (`feed.xml`), and the landing page (`index.html`).
- **Database:** A simple JSON file `processed-articles.json` stored in GCS acts as the persistent cache/database.
- **Frontend:** A static `index.html` generated by the function, hosted in the GCS bucket, providing a submission form and episode list.

### 2. Key Refactoring Changes
- **Parser Migration:** Removed `rss-parser`. Created `article-parser.js` which uses Mozilla's `Readability` to extract clean content from any URL.
- **On-Demand Processing:** Removed cron/scheduling. The function now triggers immediately on HTTP POST/GET.
- **Naming & Branding:** Entire project rebranded from "Instapaper RSS" to "Sustainability TSS Podcast" with a full green color theme.
- **Consolidation:** Removed redundant scripts (`regenerate-site.js`, `test-local.js`, etc.) and merged logic into `index.js` (local) and `function.js` (cloud).

### 3. Deployment Information
- **Project:** `hippo-ideas`
- **Region:** `europe-west2` (London)
- **Service Account:** `971698071276-compute@developer.gserviceaccount.com`
- **Timeout:** Increased to **540s (9 minutes)** to handle long-form article generation.
- **Command:** `npm run deploy` (configured in `package.json`).

### 4. Caching & Performance
- **Cache-Control:** `cloud-storage.js` is configured to set `no-cache, no-store, must-revalidate` for `.html`, `.xml`, and `.json` files. This ensures the landing page and feed update immediately for users without browser caching issues.
- **TTS Model:** Uses `en-US-Chirp3-HD-Achernar` (Chirp 3 HD) for high-fidelity audio.

## üõ†Ô∏è Key Files
- `function.js`: The main entry point for the Cloud Function. Handles CORS, URL processing, and site regeneration.
- `article-parser.js`: Logic for fetching and cleaning web content.
- `landing-page.js`: Template and generation logic for the green-themed UI.
- `cloud-storage.js`: Wrapper for GCS operations with specific metadata handling for caching.
- `config.js`: Central configuration for project IDs, buckets, and TTS settings.

## üìã Operational Instructions

### Adding a Logo
The site expects a logo at `gs://sustainability-podcast-data/logo.png`. To update it:
```bash
gcloud storage cp your-logo.png gs://sustainability-podcast-data/logo.png
```

### Local Testing
To process an article from your local machine:
```bash
node index.js https://example.com/article-url
```

### Manual Regeneration
To force the site to rebuild without adding a new article:
```bash
curl -X POST https://europe-west2-hippo-ideas.cloudfunctions.net/sustainability-tss-podcast
```

## üîó Links
- **Public Site:** [https://storage.googleapis.com/sustainability-podcast-data/index.html](https://storage.googleapis.com/sustainability-podcast-data/index.html)
- **RSS Feed:** [https://storage.googleapis.com/sustainability-podcast-data/feed.xml](https://storage.googleapis.com/sustainability-podcast-data/feed.xml)
- **GitHub:** [https://github.com/harvy4002/sustainability-tss-podcast](https://github.com/harvy4002/sustainability-tss-podcast)

## License
MIT

---

## üìù TODO List
- [ ] Incorporate podcasts (RSS feeds of existing podcasts) as a source.
- [ ] Support for multiple languages.
- [ ] Ability to customize voice per article.
- [ ] Batch upload support.
